ğŸ“¦ KUBERNETES DEPLOYMENT - COMPLETE SETUP

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROJECT: VHT Community Learning Platform - 3-Node Kubernetes Cluster
AUTHOR: Charles Herbert Matovu
CREATED: January 18, 2026
PLATFORM: Google Kubernetes Engine (GKE)
STATUS: âœ… READY FOR DEPLOYMENT

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ WHAT'S BEEN CREATED FOR KUBERNETES DEPLOYMENT

ğŸ“ Docker Configuration (3 files)
   âœ… Dockerfile           - Multi-stage Node.js container image
   âœ… docker-compose.yml   - Local development with Redis & PostgreSQL
   âœ… .dockerignore        - Build context optimization

â˜¸ï¸  Kubernetes Manifests (4 files in k8s/)
   âœ… deployment.yaml      - 3-pod deployment with HPA, probes, security
   âœ… services.yaml        - Redis & PostgreSQL StatefulSets
   âœ… policies.yaml        - Network policies, quotas, limits
   âœ… ingress.yaml         - Ingress with TLS, ServiceMonitor

ğŸ“Š Helm Chart (2 files in helm/vht-platform/)
   âœ… Chart.yaml           - Helm chart metadata
   âœ… values.yaml          - Configurable deployment parameters

ğŸ—ï¸  Terraform for GKE (1 file)
   âœ… kubernetes.tf        - 3-node cluster provisioning on GCP

ğŸ”„ Updated CI/CD Pipeline (1 file)
   âœ… k8s-deploy.yml       - Docker build & Kubernetes deployment workflow

ğŸ“š Documentation (1 file)
   âœ… KUBERNETES_DEPLOYMENT.md - Complete K8s deployment guide

ğŸš€ Quick Start Script (1 file)
   âœ… k8s-deploy.sh        - One-command K8s cluster deployment

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ 3-NODE KUBERNETES CLUSTER CONFIGURATION

Node Specifications
   Machine Type:          e2-standard-2 (2 vCPU, 8GB RAM each)
   Node Count:            3 (minimum)
   Auto-scaling:          3-9 nodes based on resource utilization
   Total Capacity:        6 vCPU, 24GB RAM base

Pod Deployment
   VHT Platform:
   - Replicas:           3 (1 pod per node initially)
   - Min Replicas:       3 (maintain availability)
   - Max Replicas:       9 (via HPA)
   - CPU Requests:       250m per pod
   - Memory Requests:    256Mi per pod
   - CPU Limits:         500m per pod
   - Memory Limits:      512Mi per pod

   Pod Distribution:
   Node 1: vht-platform-pod-1, redis-0, postgres-0
   Node 2: vht-platform-pod-2
   Node 3: vht-platform-pod-3

Supporting Services
   Redis:                StatefulSet (1 replica)
   PostgreSQL:           StatefulSet (1 replica)
   Load Balancer:        Google Cloud Load Balancer
   Ingress:              Nginx Ingress with TLS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ QUICK START - DEPLOY IN 5 MINUTES

OPTION 1: Automated Deployment (Linux/Mac)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ chmod +x k8s-deploy.sh
$ ./k8s-deploy.sh

OPTION 2: Manual Step-by-Step
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Provision cluster:
   $ terraform apply -var-file=terraform.tfvars

2. Get credentials:
   $ gcloud container clusters get-credentials vht-learning-platform-dev \
     --region us-central1 --project YOUR_PROJECT_ID

3. Deploy with Helm:
   $ helm install vht-platform ./helm/vht-platform \
     --namespace vht-community --create-namespace

4. Verify:
   $ kubectl get pods -n vht-community

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š DEPLOYMENT ARCHITECTURE

VHT Community Learning Platform on GKE
â”‚
â”œâ”€ GKE Cluster (us-central1)
â”‚  â”œâ”€ 3 Nodes (e2-standard-2)
â”‚  â”œâ”€ VPC Network (10.0.0.0/24)
â”‚  â”œâ”€ Secondary IP ranges (pods, services)
â”‚  â””â”€ Auto-scaling (3-9 nodes)
â”‚
â”œâ”€ vht-community Namespace
â”‚  â”œâ”€ Deployments
â”‚  â”‚  â””â”€ vht-platform (3 pods with HPA)
â”‚  â”‚
â”‚  â”œâ”€ StatefulSets
â”‚  â”‚  â”œâ”€ vht-redis (1 replica, 5Gi storage)
â”‚  â”‚  â””â”€ vht-postgres (1 replica, 20Gi storage)
â”‚  â”‚
â”‚  â”œâ”€ Services
â”‚  â”‚  â”œâ”€ vht-platform-service (LoadBalancer)
â”‚  â”‚  â”œâ”€ vht-redis-service (ClusterIP)
â”‚  â”‚  â””â”€ vht-postgres-service (ClusterIP)
â”‚  â”‚
â”‚  â”œâ”€ Ingress
â”‚  â”‚  â””â”€ vht-platform-ingress (TLS via cert-manager)
â”‚  â”‚
â”‚  â”œâ”€ ConfigMaps
â”‚  â”‚  â””â”€ vht-platform-config (environment variables)
â”‚  â”‚
â”‚  â”œâ”€ Secrets
â”‚  â”‚  â””â”€ vht-platform-secrets (sensitive data)
â”‚  â”‚
â”‚  â”œâ”€ Network Policies
â”‚  â”‚  â”œâ”€ Pod-to-service communication
â”‚  â”‚  â”œâ”€ Ingress restrictions
â”‚  â”‚  â””â”€ Egress to dependencies
â”‚  â”‚
â”‚  â”œâ”€ Resource Quotas
â”‚  â”‚  â””â”€ CPU: 6 requests, 12 limits
â”‚  â”‚  â””â”€ Memory: 6Gi requests, 12Gi limits
â”‚  â”‚
â”‚  â””â”€ Horizontal Pod Autoscaler
â”‚     â”œâ”€ Target CPU: 70%
â”‚     â”œâ”€ Target Memory: 80%
â”‚     â””â”€ Scale up/down policies

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”’ SECURITY FEATURES

Container Security
   âœ“ Non-root user (UID 1001)
   âœ“ Read-only root filesystem
   âœ“ Dropped all capabilities
   âœ“ No privilege escalation
   âœ“ Health checks (liveness & readiness)

Network Security
   âœ“ Network policies (ingress/egress)
   âœ“ Pod-to-pod communication restricted
   âœ“ Service-to-service communication allowed
   âœ“ TLS encryption (cert-manager + Let's Encrypt)
   âœ“ Private cluster recommended

Data Protection
   âœ“ Persistent volumes encrypted
   âœ“ Secrets management (Kubernetes Secrets)
   âœ“ Database credentials in Secrets
   âœ“ API keys in Secrets

Access Control
   âœ“ RBAC (Role-Based Access Control)
   âœ“ Service accounts per component
   âœ“ Workload Identity Federation
   âœ“ Audit logging enabled

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ˆ SCALING & AUTO-SCALING

Horizontal Pod Autoscaling (HPA)
   Metric 1: CPU Utilization
   - Target: 70%
   - Scale up when exceeded
   - Scale down after stabilization

   Metric 2: Memory Utilization
   - Target: 80%
   - Scale up when exceeded
   - Scale down after stabilization

   Behavior:
   - Min replicas: 3
   - Max replicas: 9
   - Scale-up window: 30s (aggressive)
   - Scale-down window: 5m (conservative)

Node Autoscaling
   - Minimum nodes: 3
   - Maximum nodes: 9
   - Trigger: Pod pending or resource utilization
   - Cool-down: Built-in delays to prevent flapping

Manual Scaling
   $ kubectl scale deployment vht-platform --replicas=5 -n vht-community

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‚ KUBERNETES FILES STRUCTURE

cicd-terraform/
â”œâ”€â”€ Dockerfile                           # Container image
â”œâ”€â”€ docker-compose.yml                   # Local dev environment
â”œâ”€â”€ .dockerignore                        # Build context ignore
â”œâ”€â”€ kubernetes.tf                        # GKE cluster provisioning
â”‚
â”œâ”€â”€ k8s/
â”‚  â”œâ”€â”€ deployment.yaml                  # App deployment (3 pods)
â”‚  â”œâ”€â”€ services.yaml                    # Redis & PostgreSQL
â”‚  â”œâ”€â”€ policies.yaml                    # Network policies, quotas
â”‚  â””â”€â”€ ingress.yaml                     # TLS ingress
â”‚
â”œâ”€â”€ helm/
â”‚  â””â”€â”€ vht-platform/
â”‚     â”œâ”€â”€ Chart.yaml                    # Helm chart metadata
â”‚     â”œâ”€â”€ values.yaml                   # Helm configuration
â”‚     â””â”€â”€ templates/                    # (Generated from manifests)
â”‚
â”œâ”€â”€ KUBERNETES_DEPLOYMENT.md            # Complete K8s guide
â”œâ”€â”€ k8s-deploy.sh                       # Quick start script
â””â”€â”€ .github/workflows/
   â””â”€â”€ k8s-deploy.yml                  # CI/CD pipeline

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”„ CI/CD PIPELINE FOR KUBERNETES

GitHub Actions Workflow: k8s-deploy.yml
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Trigger Events:
   - Push to main or develop branch
   - Changes to src/, package*.json, Dockerfile, k8s/, helm/

Build Job:
   1. Checkout code
   2. Setup Docker Buildx
   3. Authenticate to GCP
   4. Extract image metadata
   5. Build & push Docker image to GCR
   6. Update Helm values with new image tag
   7. Commit changes

Deploy Job (main branch only):
   1. Authenticate to GCP
   2. Get GKE cluster credentials
   3. Setup Helm
   4. Deploy with Helm (auto-update)
   5. Verify rollout (5m timeout)
   6. Health checks
   7. Notification (success/failure)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PREREQUISITES FOR DEPLOYMENT

Google Cloud Setup
   â˜ GCP project created
   â˜ Billing enabled
   â˜ Service account created
   â˜ Container Registry enabled
   â˜ Kubernetes Engine API enabled
   â˜ Compute Engine API enabled

Local Tools
   â˜ gcloud CLI installed & authenticated
   â˜ kubectl installed
   â˜ helm installed (v3.0+)
   â˜ docker installed (for local builds)
   â˜ terraform installed (v1.0+)

GitHub
   â˜ Repository secrets configured
   â˜ WIF_PROVIDER configured
   â˜ WIF_SERVICE_ACCOUNT configured
   â˜ GitHub Actions enabled

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ STEP-BY-STEP DEPLOYMENT

STEP 1: Initialize GCP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ gcloud config set project YOUR_PROJECT_ID
$ gcloud auth application-default login

STEP 2: Create Terraform Variables
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Edit terraform.tfvars:
   gcp_project_id = "your-project-id"
   cluster_name = "vht-learning-platform"
   kubernetes_node_count = 3
   kubernetes_machine_type = "e2-standard-2"

STEP 3: Provision GKE Cluster
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ terraform init
$ terraform plan -var-file=terraform.tfvars
$ terraform apply -var-file=terraform.tfvars

Expected time: 10-15 minutes

STEP 4: Configure kubectl
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ gcloud container clusters get-credentials vht-learning-platform-dev \
    --region us-central1 --project YOUR_PROJECT_ID
$ kubectl cluster-info

STEP 5: Deploy Application
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Option A - Helm (recommended):
$ helm install vht-platform ./helm/vht-platform \
    --namespace vht-community --create-namespace

Option B - kubectl:
$ kubectl apply -f k8s/deployment.yaml
$ kubectl apply -f k8s/services.yaml
$ kubectl apply -f k8s/policies.yaml

STEP 6: Verify Deployment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ kubectl get pods -n vht-community
$ kubectl get svc -n vht-community
$ kubectl rollout status deployment/vht-platform -n vht-community

STEP 7: Access Application
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ kubectl port-forward -n vht-community svc/vht-platform-service 8080:80
$ curl http://localhost:8080

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ’° ESTIMATED MONTHLY COSTS

Resource                    Est. Cost/Month
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3x e2-standard-2 Nodes      $60-90
GKE Management              $74 (standard cluster)
Network LB                  $16
Storage (PVCs, 25Gi)        $2-5
Cloud DNS                   $0.40
Data Transfer              $1-5
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total Estimated:           $150-180/month

Cost Optimization Tips:
   â€¢ Use preemptible nodes (-70% cost): $15-25/month
   â€¢ Use e2-medium machines: $30-45/month
   â€¢ Reduce storage: $1-2/month
   â€¢ Optimized total: $50-75/month

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“š USEFUL COMMANDS

Deployment Management:
   $ helm list -n vht-community
   $ helm upgrade vht-platform ./helm/vht-platform -n vht-community
   $ kubectl set image deployment/vht-platform vht-platform=IMAGE:TAG -n vht-community

Pod Management:
   $ kubectl logs -n vht-community -l app=vht-platform -f
   $ kubectl exec -it POD_NAME -n vht-community -- /bin/sh
   $ kubectl describe pod POD_NAME -n vht-community

Scaling:
   $ kubectl scale deployment vht-platform --replicas=5 -n vht-community
   $ kubectl top pods -n vht-community

Debugging:
   $ kubectl get events -n vht-community
   $ kubectl port-forward svc/vht-platform-service 8080:80 -n vht-community
   $ kubectl port-forward svc/vht-postgres-service 5432:5432 -n vht-community

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“– DOCUMENTATION

Complete Guides:
   â€¢ KUBERNETES_DEPLOYMENT.md - Full deployment guide
   â€¢ README.md                - Project overview
   â€¢ DEPLOYMENT.md            - GCP setup
   â€¢ CICD_SETUP.md            - GitHub Actions

Quick References:
   â€¢ k8s-deploy.sh           - One-command deployment
   â€¢ Dockerfile              - Container specifications
   â€¢ values.yaml             - Helm configuration

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… DEPLOYMENT CHECKLIST

Pre-Deployment:
   â˜ GCP project ready
   â˜ All tools installed
   â˜ Service account created
   â˜ terraform.tfvars configured
   â˜ Docker image registry ready

Deployment:
   â˜ Terraform applied successfully
   â˜ GKE cluster created (3 nodes)
   â˜ kubectl authenticated
   â˜ Helm chart deployed
   â˜ All pods running
   â˜ Services available
   â˜ Ingress configured

Post-Deployment:
   â˜ Health checks passing
   â˜ Logs monitoring
   â˜ HPA configured
   â˜ Network policies enabled
   â˜ Backups configured
   â˜ Monitoring setup

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‰ YOU'RE READY TO DEPLOY TO KUBERNETES!

Next Steps:
1. Review KUBERNETES_DEPLOYMENT.md for detailed instructions
2. Configure terraform.tfvars with your GCP details
3. Run k8s-deploy.sh or follow manual steps
4. Monitor deployment: kubectl get pods -n vht-community

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Built with â¤ï¸ for community empowerment in Uganda
VHT Community Learning Platform - Kubernetes Edition
Author: Charles Herbert Matovu | Created: 2025

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
